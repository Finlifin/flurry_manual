# 第 4 章：变量、所有权与资源管理

Flurry 作为一门系统级编程语言，对资源的精确控制和内存安全给予了高度重视。与传统的 C/C++ 手动管理内存不同，也与纯粹的垃圾回收机制不同，Flurry 采用了一套结合了**所有权 (Ownership)**、**仿射类型 (Affine Types)** 和**自动资源管理**的机制，并辅以独特的**可达性分析**与**副作用系统**来确保安全性和效率。

本章将深入探讨 Flurry 如何管理变量的生命周期、数据的所有权以及相关资源的释放。理解这些核心概念对于编写安全、高效且无内存泄漏的 Flurry 代码至关重要。

**核心概念:**

*   **变量绑定**: 如何在 Flurry 中声明变量和常量。
*   **所有权**: 每个值在 Flurry 中都有一个明确的“所有者”。所有权决定了谁负责清理资源。
*   **移动语义**: 对于非 `Copy` 类型，所有权如何在变量绑定、函数调用和返回时发生转移。
*   **仿射类型**: 非 `Copy` 类型的值默认遵循“至多使用一次”的规则，这是确保资源安全的关键。
*   **引用**: 如何在不转移所有权的情况下安全地访问数据。
*   **自动资源管理 (`drop`)**: 编译器如何自动管理资源的释放（如内存、文件句柄等）。
*   **安全保证机制**: 概述 Flurry 如何通过类型系统、可达性分析和副作用跟踪来保证内存安全（特别是引用的有效性）。

**章节内容:**

*   **[声明与绑定](core/ownership/bindings.md)**: 介绍 `let` 和 `const` 如何用于创建变量和常量绑定，并讨论 Flurry 在可变性方面的设计选择。
*   **[仿射类型与移动语义](core/ownership/affine_move.md)**: 详细解释 `Once`, `Clone`, `Copy` Trait 层次，以及非 `Copy` 类型的所有权转移规则。
*   **[引用与借用](core/ownership/references.md)**: 探讨指针 (`*`) 和切片 (`Slice`) 等引用类型的作用，以及 Flurry 特色的后缀引用 (`.ref`) 和解引用 (`.*`) 语法。
*   **[资源管理与 Drop](core/ownership/drop.md)**: 阐述 Flurry 的 RAII 原则和编译器自动插入 `drop` 调用的机制。
*   **[引用有效性：可达性与副作用](core/ownership/reachability_effects.md)**: 简要介绍 Flurry 用于保证引用有效性的高级机制的目标和作用（为后续深入探讨做铺垫）。

掌握 Flurry 的所有权和资源管理系统是编写健壮系统级代码的基础。它旨在提供 C/C++ 级别的控制力和性能，同时具备现代语言的内存安全保证。
