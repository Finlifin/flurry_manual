<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>常用运算符 - Flurry语言手册</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Flurry语言手册</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="常用运算符"><a class="header" href="#常用运算符">常用运算符</a></h2>
<p>运算符是 Flurry 语言中用于执行计算、比较、逻辑组合等操作的特殊符号。Flurry 提供了一组旨在清晰且富有表现力的运算符集合。</p>
<h3 id="算术运算符"><a class="header" href="#算术运算符">算术运算符</a></h3>
<p>用于执行基本的数学运算。这些运算符通常可以被用户定义的类型通过实现特定的 Trait 来重载。</p>
<ul>
<li><strong>加法 (<code>+</code>)</strong>: <code>a + b</code></li>
<li><strong>减法 (<code>-</code>)</strong>: <code>a - b</code></li>
<li><strong>乘法 (<code>*</code>)</strong>: <code>a * b</code></li>
<li><strong>除法 (<code>/</code>)</strong>: <code>a / b</code> (整数除法通常向零截断，浮点数除法遵循 IEEE 754)</li>
<li><strong>取模 (<code>%</code>)</strong>: <code>a % b</code> (计算除法的余数)</li>
</ul>
<p><strong>空格敏感性</strong>: 如词法结构中所述，这些二元算术运算符<strong>必须</strong>在其两侧使用空格，以便被词法分析器正确识别为标准算术运算符 token（例如 <code>_+_</code>）。<code>a+b</code> 不会被识别为标准的加法运算。</p>
<pre><code class="language-flurry">let sum = count + 1;
let difference = total - tax;
let area = width * height;
let quotient = dividend / divisor;
let remainder = value % modulus;
</code></pre>
<h3 id="比较运算符"><a class="header" href="#比较运算符">比较运算符</a></h3>
<p>用于比较两个值，结果通常是一个布尔值 (<code>bool</code>)。它们也可以被重载。</p>
<ul>
<li><strong>等于 (<code>==</code>)</strong>: <code>a == b</code></li>
<li><strong>不等于 (<code>!=</code>)</strong>: <code>a != b</code></li>
<li><strong>小于 (<code>&lt;</code>)</strong>: <code>a &lt; b</code></li>
<li><strong>小于等于 (<code>&lt;=</code>)</strong>: <code>a &lt;= b</code></li>
<li><strong>大于 (<code>&gt;</code>)</strong>: <code>a &gt; b</code></li>
<li><strong>大于等于 (<code>&gt;=</code>)</strong>: <code>a &gt;= b</code></li>
</ul>
<p><strong>空格敏感性</strong>: 小于 (<code>&lt;</code>) 和大于 (<code>&gt;</code>) 运算符同样具有<strong>空格敏感性</strong>。当用于比较时，它们两侧<strong>必须</strong>有空格（对应 <code>_&lt;_</code> 和 <code>_&gt;_</code> token）。这避免了与泛型参数列表等场景中使用的尖括号 (<code>&lt;</code>, <code>&gt;</code>) 产生词法歧义。</p>
<pre><code class="language-flurry">let is_equal = response_code == 200;
let is_not_empty = size != 0;
let in_range = value &gt;= min_value and value &lt;= max_value; -- 注意 'and' 关键字
let needs_update = current_version &lt; latest_version;
</code></pre>
<h3 id="逻辑运算符"><a class="header" href="#逻辑运算符">逻辑运算符</a></h3>
<p>用于组合布尔值。Flurry 使用关键字而非符号来表示逻辑与和或。</p>
<ul>
<li><strong>逻辑与 (<code>and</code>)</strong>: <code>a and b</code> (短路求值：如果 <code>a</code> 为 <code>false</code>，则不评估 <code>b</code>)</li>
<li><strong>逻辑或 (<code>or</code>)</strong>: <code>a or b</code> (短路求值：如果 <code>a</code> 为 <code>true</code>，则不评估 <code>b</code>)</li>
<li><strong>逻辑非 (<code>not</code>)</strong>: <code>not a</code> (一元运算符)</li>
</ul>
<pre><code class="language-flurry">let both_conditions_met = is_ready and has_permission;
let either_option_valid = is_primary or is_fallback;
let is_invalid = not is_valid;
</code></pre>
<h3 id="赋值运算符"><a class="header" href="#赋值运算符">赋值运算符</a></h3>
<p>用于将值赋给变量绑定。</p>
<ul>
<li><strong>简单赋值 (<code>=</code>)</strong>: <code>variable = value</code></li>
<li><strong>复合赋值</strong>:
<ul>
<li><code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code> (例如 <code>a += b</code> 等价于 <code>a = a + b</code>)</li>
</ul>
</li>
</ul>
<pre><code class="language-flurry">let score = 0;
score += 10; -- score 现在是 10
</code></pre>
<p><em>注意：由于 Flurry 可能默认绑定是可变的，<code>let</code> 声明的 <code>score</code> 可以被复合赋值操作修改。</em></p>
<h3 id="其他重要操作符结构"><a class="header" href="#其他重要操作符结构">其他重要操作符/结构</a></h3>
<p>Flurry 还包含一些具有特殊语法和用途的操作符或结构，其中许多采用后缀形式（详见下一节）：</p>
<ul>
<li><strong>选择运算符 (<code>.</code>)</strong>: 用于访问成员、调用方法、限定路径等。</li>
<li><strong>解引用 (<code>.*</code>)</strong>: 后缀操作符，用于访问指针指向的值。</li>
<li><strong>取引用 (<code>.ref</code>)</strong>: 后缀操作符，用于获取一个值的指针。</li>
<li><strong>取像 (<code>'</code>)</strong>: 后缀操作符，用于 <code>expr ' image</code> 操作。</li>
<li><strong>调用操作符</strong>: <code>()</code> (函数调用), <code>[]</code> (索引调用), <code>{}</code> (<code>expr object</code> 调用/记录调用), <code>&lt;&gt;</code> (泛型/钻石调用)。</li>
<li><strong>错误/可选处理</strong>: <code>!</code> (错误传播/处理), <code>?</code> (可选类型处理)。</li>
<li><strong>效应处理</strong>: <code>#</code> (效应处理块)。</li>
<li><strong>属性标记 (<code>^</code>)</strong>: 用于附加属性。</li>
<li><strong>管道操作符 (<code>|</code>, <code>|&gt;</code>)</strong>: 用于函数式风格的数据流处理。</li>
</ul>
<h3 id="编译时连接运算符-"><a class="header" href="#编译时连接运算符-">编译时连接运算符 (<code>++</code>)</a></h3>
<ul>
<li><strong><code>++</code></strong>: 这个运算符<strong>专用于编译时</strong>，用于连接两个集合类的值。</li>
<li><strong>适用类型</strong>: 其具体行为取决于操作数类型所实现的特定 Trait（可重载）。常见的应用包括：
<ul>
<li>连接编译时字符串 (<code>str</code>)。</li>
<li>连接编译时列表 (<code>meta.List</code>)。</li>
<li>连接编译时集合 (<code>meta.Set</code>)。</li>
<li>连接 <code>bitvec</code> 抽象视图（编译器会将其优化为位操作）。</li>
</ul>
</li>
<li><strong>限制</strong>: <strong>不能</strong>直接用于运行时的值（除了 <code>bitvec</code> 抽象视图映射这种特殊情况，其本质也是编译时指导的优化）。</li>
</ul>
<pre><code class="language-flurry">comptime {
    const part1 = "Hello, ";
    const part2 = "Flurry!";
    const message = part1 ++ part2; -- message == "Hello, Flurry!"

    const list1 = meta.List.new(1, 2);
    const list2 = meta.List.new(3, 4);
    const combined_list = list1 ++ list2; -- combined_list == [1, 2, 3, 4]

    -- let runtime_vec1 = Vec.new();
    -- let runtime_vec2 = Vec.new();
    -- let result = runtime_vec1 ++ runtime_vec2; -- 编译错误！++ 不能用于运行时 Vec
}
</code></pre>
<h3 id="关于位运算符"><a class="header" href="#关于位运算符">关于位运算符</a></h3>
<p>值得再次强调，Flurry <strong>不提供</strong>内建的按位运算符（如 C/Java/Rust 中的 <code>&amp;</code>, <code>|</code>, <code>^</code>, <code>~</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>）。进行位级别的操作需要：</p>
<ol>
<li><strong>使用 <code>bitvec</code> 抽象视图</strong>: 通过取像操作 <code>value'bitvec</code> 获取值的位向量表示，然后对其进行连接 (<code>++</code>) 或其他位操作（这些操作会被编译器优化）。</li>
<li><strong>使用标准库函数</strong>: Flurry 计划提供一个内置的 <code>math</code>（或其他）包，其中包含执行位移、按位与/或/异或等操作的函数（例如 <code>math.bit_and(a, b)</code>）。</li>
</ol>
<p>这种设计选择旨在减少操作符集合的歧义，并将底层位操作封装在更明确的抽象（<code>bitvec</code>）或库函数中。</p>
<h3 id="运算符优先级与结合性"><a class="header" href="#运算符优先级与结合性">运算符优先级与结合性</a></h3>
<p>Flurry 使用 Pratt 解析器常用的<strong>绑定力 (Binding Power)</strong> 或等效的优先级方案来确定复杂表达式中运算符的计算顺序。您提供的 <code>OpTable</code> Scala 代码片段清晰地展示了不同 token 对应的优先级数值（数值越高，通常绑定得越紧密）。</p>
<p>例如，根据该表：</p>
<ul>
<li>乘法/除法/取模/<code>++</code> (<code>70</code>) 的优先级高于加法/减法 (<code>60</code>)。</li>
<li>加法/减法 (<code>60</code>) 的优先级高于比较运算符 (<code>40</code>)。</li>
<li>比较运算符 (<code>40</code>) 的优先级高于逻辑与 (<code>30</code>) 和逻辑或 (<code>20</code>)。</li>
<li>后缀操作符如选择 (<code>.</code>, 100)、取像 (<code>'</code>, 100)、调用 (<code>()</code>, <code>[]</code>, <code>{}</code>, <code>&lt;&gt;</code>, 90) 和可能的字面量拓展 (<code>id</code>, 110) 具有非常高的优先级。</li>
</ul>
<p>开发者通常不需要死记硬背完整的优先级表，而是遵循数学和逻辑运算的常规顺序，并在必要时使用圆括号 <code>()</code> 来明确指定求值顺序。</p>
<pre><code class="language-flurry">let result = a + b * c; -- 等价于 a + (b * c)，因为 * 优先级更高
let flag = x &gt; 0 and y &lt; 10; -- 等价于 (x &gt; 0) and (y &lt; 10)
let complex = (a + b) * (c - d); -- 使用括号强制优先级
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../core/expressions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../core/expressions/suffix_chaining.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../core/expressions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../core/expressions/suffix_chaining.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
